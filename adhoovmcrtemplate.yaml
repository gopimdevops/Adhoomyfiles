---
"$schema": http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#
contentVersion: 1.0.0.0
parameters:
  location:
    type: string
  networkInterfaceName:
    type: string
  networkSecurityGroupName:
    type: string
  networkSecurityGroupRules:
    type: array
  subnetName:
    type: string
  virtualNetworkId:
    type: string
  publicIpAddressName:
    type: string
  publicIpAddressType:
    type: string
  publicIpAddressSku:
    type: string
  virtualMachineName:
    type: string
  virtualMachineRG:
    type: string
  osDiskType:
    type: string
  virtualMachineSize:
    type: string
  adminUsername:
    type: string
  adminPassword:
    type: secureString
  diagnosticsStorageAccountName:
    type: string
  diagnosticsStorageAccountId:
    type: string
  diagnosticsStorageAccountType:
    type: string
  diagnosticsStorageAccountKind:
    type: string
variables:
  nsgId: "[resourceId(resourceGroup().name, 'Microsoft.Network/networkSecurityGroups',
    parameters('networkSecurityGroupName'))]"
  vnetId: "[parameters('virtualNetworkId')]"
  subnetRef: "[concat(variables('vnetId'), '/subnets/', parameters('subnetName'))]"
resources:
- name: "[parameters('networkInterfaceName')]"
  type: Microsoft.Network/networkInterfaces
  apiVersion: '2018-10-01'
  location: "[parameters('location')]"
  dependsOn:
  - "[concat('Microsoft.Network/networkSecurityGroups/', parameters('networkSecurityGroupName'))]"
  - "[concat('Microsoft.Network/publicIpAddresses/', parameters('publicIpAddressName'))]"
  properties:
    ipConfigurations:
    - name: ipconfig1
      properties:
        subnet:
          id: "[variables('subnetRef')]"
        privateIPAllocationMethod: Dynamic
        publicIpAddress:
          id: "[resourceId(resourceGroup().name, 'Microsoft.Network/publicIpAddresses',
            parameters('publicIpAddressName'))]"
    networkSecurityGroup:
      id: "[variables('nsgId')]"
- name: "[parameters('networkSecurityGroupName')]"
  type: Microsoft.Network/networkSecurityGroups
  apiVersion: '2019-02-01'
  location: "[parameters('location')]"
  properties:
    securityRules: "[parameters('networkSecurityGroupRules')]"
- name: "[parameters('publicIpAddressName')]"
  type: Microsoft.Network/publicIpAddresses
  apiVersion: '2019-02-01'
  location: "[parameters('location')]"
  properties:
    publicIpAllocationMethod: "[parameters('publicIpAddressType')]"
  sku:
    name: "[parameters('publicIpAddressSku')]"
- name: "[parameters('virtualMachineName')]"
  type: Microsoft.Compute/virtualMachines
  apiVersion: '2019-03-01'
  location: "[parameters('location')]"
  dependsOn:
  - "[concat('Microsoft.Network/networkInterfaces/', parameters('networkInterfaceName'))]"
  - "[concat('Microsoft.Storage/storageAccounts/', parameters('diagnosticsStorageAccountName'))]"
  properties:
    hardwareProfile:
      vmSize: "[parameters('virtualMachineSize')]"
    storageProfile:
      osDisk:
        createOption: fromImage
        managedDisk:
          storageAccountType: "[parameters('osDiskType')]"
      imageReference:
        publisher: RedHat
        offer: RHEL
        sku: '7.4'
        version: latest
    networkProfile:
      networkInterfaces:
      - id: "[resourceId('Microsoft.Network/networkInterfaces', parameters('networkInterfaceName'))]"
    osProfile:
      computerName: "[parameters('virtualMachineName')]"
      adminUsername: "[parameters('adminUsername')]"
      adminPassword: "[parameters('adminPassword')]"
    diagnosticsProfile:
      bootDiagnostics:
        enabled: true
        storageUri: "[concat('https://', parameters('diagnosticsStorageAccountName'),
          '.blob.core.windows.net/')]"
- name: "[parameters('diagnosticsStorageAccountName')]"
  type: Microsoft.Storage/storageAccounts
  apiVersion: '2019-04-01'
  location: "[parameters('location')]"
  properties: {}
  kind: "[parameters('diagnosticsStorageAccountKind')]"
  sku:
    name: "[parameters('diagnosticsStorageAccountType')]"
outputs:
  adminUsername:
    type: string
    value: "[parameters('adminUsername')]"

    ---
"$schema": https://schema.management.azure.com/schemas/2015-01-01/deploymentParameters.json#
contentVersion: 1.0.0.0
parameters:
  location:
    value: southindia
  networkInterfaceName:
    value: adhoorhelvm01596
  networkSecurityGroupName:
    value: adhoorhelvm01-nsg
  networkSecurityGroupRules:
    value:
    - name: SSH
      properties:
        priority: 300
        protocol: TCP
        access: Allow
        direction: Inbound
        sourceAddressPrefix: "*"
        sourcePortRange: "*"
        destinationAddressPrefix: "*"
        destinationPortRange: '22'
  subnetName:
    value: adhoodevsub01
  virtualNetworkId:
    value: "/subscriptions/985174d3-947b-43a7-ac89-10fd1dd87cd3/resourceGroups/adhooRG001/providers/Microsoft.Network/virtualNetworks/adhoovnet001"
  publicIpAddressName:
    value: adhoorhelvm01-ip
  publicIpAddressType:
    value: Dynamic
  publicIpAddressSku:
    value: Basic
  virtualMachineName:
    value: adhoorhelvm01
  virtualMachineRG:
    value: adhooRG001
  osDiskType:
    value: StandardSSD_LRS
  virtualMachineSize:
    value: Standard_D1_v2
  adminUsername:
    value: azureuser
  adminPassword:
    value: @adhoo@172209